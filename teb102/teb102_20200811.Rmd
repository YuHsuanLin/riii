---
title: "R_DataMining1"
author: "York Lin"
date: "2020年08月11日"
output: html_document
editor_options: 
  chunk_output_type: console
---

### dplyr
```{R}
#install.packages('dplyr')
data("iris")
library('dplyr')

#filter
iris[iris$Species== 'setosa',]
filter(iris,Species=='setosa')

#select
iris[,c('Sepal.Length','Sepal.Width')]
select(iris,Sepal.Length,Sepal.Width)

head(filter(select(iris,Sepal.Length,Species),Species=='setosa'))

#chaining
iris %>%
select(.,Sepal.Length,Species) %>%
filter(.,Species=='setosa') %>%
head(.)

#arrange
iris %>%
  select(Sepal.Length,Species) %>%
  filter(Species=='setosa') %>%
  arrange(desc(Sepal.Length)) %>%
  head(10)

### group_by + summarise
iris %>%
  group_by(Species) %>%
  summarise(sepal_length_mean = mean(Sepal.Length)) %>%
  arrange(sepal_length_mean)

### group_by + summarise_at
iris %>%
  group_by(Species) %>%
  summarise_at(.vars=vars(Sepal.Length,Sepal.Width,Petal.Length,Petal.Width),.funs=funs(mean,median,max,min,sd))

## dplyr 0.8up funs() -> list()
iris %>%
  group_by(Species) %>%
  summarise_at(.vars=vars(Sepal.Length,Sepal.Width,Petal.Length,Petal.Width),.funs=list(mean,median,min,max))
```


### alter mysql 8.0 password encryption
- https://stackoverflow.com/questions/49194719/authentication-plugin-caching-sha2-password-cannot-be-loaded

在MySQL workbench執行以下指令
```
ALTER USER 'yourusername'@'localhost' IDENTIFIED WITH mysql_native_password BY 'youpassword';

CREATE DATABASE test CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```
### connect MySQL example
```{R}
#install.packages('dplyr')
#install.packages('RMariaDB')
#install.packages('dbplyr')
library('dplyr')
library('dbplyr')
library('RMariaDB')

data("iris")

conn = dbConnect(MariaDB(),dbname='test',host='127.0.0.1',port=3306,user='root',password='pythonetl')

dbListTables(conn)

db_drop_table(conn,'iris')
copy_to(conn,iris,temporary = F)

tbl(conn,"iris") %>%
  select(starts_with('Sepal'),'Species') %>%
  group_by(Species) %>%
  summarise_at(.funs=funs(mean(.,na.rm=T),sd(.,na.rm=T)),.vars=vars(starts_with('Sepal'))) %>%
  collect()

?show_query

dbGetQuery(conn,'select * from iris') %>% filter(Species == 'setosa')
dbGetQuery(conn,'select `Sepal.Length` from iris')
```