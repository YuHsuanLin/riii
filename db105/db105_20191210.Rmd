---
title: "R_basic4"
author: "York Lin"
date: "2019年12月10日"
output: html_document
editor_options: 
  chunk_output_type: console
---

### 其他常見字串處理函式
```{R}
#sub (取代第一個遇到的字串)
s = "aaa bbb ccc aaa bbb aaa"
sub("aaa","",s)

#利用gsub函數取代 (全局取代)
gsub("aaa","",s)

#grep()  ==> return index
test_str = c('abcd','bcd','cde')
grep('a',test_str)
test_str[grep('a',test_str)]

setwd('~/lecture/riii')
load('./Statistics/applenews.RData')

applenews[grep('中國',applenews$title[1:10]),"title"]

#grepl() ==> return boolean 
grepl('a',test_str)
test_str[grepl('a',test_str)]

#strsplit() ==> 字串分割
splited = strsplit(c('abc-def','ddd-ggg'),'-')
splited
class(splited)

### 取出list裡面部分元素
sapply(splited,function(e){e[1]})

splited_vec = unlist(splited)
length(splited_vec)
seq(from=1,to=length(splited_vec),by=2)
splited_vec[seq(from=1,to=length(splited_vec),by=2)]

#substring() ==> 取得部份字串
test_s = 'abcdef'
nchar(test_s)
substring(test_s,2,nchar('abcdef')-1)
```

### 遺失值處理(missing value)
```{R}
setwd('~/lecture/riii')
load('./Statistics/applenews.RData')

idx= sample(1:nrow(applenews),size=30)
applenews[idx,'clicked'] = NA

#找尋遺失值
is.na(applenews)
sum(is.na(applenews$clicked))

sapply(names(applenews),function(e){ sum(is.na(applenews[,e])) >0 })

cleaned_data = applenews[!is.na(applenews$clicked),]

#移除missing value
complete.cases(applenews)
cleaned_data2 = applenews[complete.cases(applenews),]
str(cleaned_data2)

#以全體平均填補
load('./Statistics/applenews.RData')
applenews[idx,'clicked'] = NA

mean_clicked = round(mean(applenews$clicked,na.rm=T),0)
applenews$clicked[is.na(applenews$clicked)] = mean_clicked

sum(is.na(applenews$clicked))
```

### 遺失值處理(missing value)(續)
```{R}
#以類別平均填補
setwd('~/lecture/riii')
load('./Statistics/applenews.RData')
applenews[idx,'clicked'] = NA

cat_means = tapply(applenews$clicked,applenews$category,function(e){round(mean(e,na.rm=T),0)})
cat_means["3C"]

for(i in names(cat_means)){
  applenews[applenews$category == i & is.na(applenews$clicked),'clicked'] = cat_means[i]
}

sum(is.na(applenews$clicked))
```

### mice
```{R}
#install.packages('mice')
library(mice)
data(iris)
na_list = sample(1:nrow(iris),15)
iris[na_list,'Sepal.Length'] = NA

mice.data <- mice(data=iris,m = 3,method = "cart")

complete(mice.data,1)

complete(mice.data,1)[na_list,'Sepal.Length']
complete(mice.data,2)[na_list,'Sepal.Length']
complete(mice.data,3)[na_list,'Sepal.Length']

##比較各模型預測結果是否穩定(mean接近0,var很小)
diff1 = complete(mice.data,1)[na_list,'Sepal.Length'] - complete(mice.data,2)[na_list,'Sepal.Length']

diff2 = complete(mice.data,1)[na_list,'Sepal.Length'] - complete(mice.data,3)[na_list,'Sepal.Length']

diff3 = complete(mice.data,2)[na_list,'Sepal.Length'] - complete(mice.data,3)[na_list,'Sepal.Length']

mean(c(diff1,diff2,diff3))
var(c(diff1,diff2,diff3))

complete(mice.data,1)
```

